function ajaxCallRemoteRecherchePaiement(d,g){var n=document.getElementById(d+"dateDebut").value;var e=document.getElementById(d+"dateFin").value;var j=document.getElementById(d+"benefSelectionne").value;var h=document.getElementById(d+"afficherIJ").checked;var k=document.getElementById(d+"afficherPT").checked;var i=document.getElementById(d+"afficherInva").checked;var b=document.getElementById(d+"afficherRentes").checked;var c=document.getElementById(d+"afficherRS").checked;var l=document.getElementById(d+"indexPaiement").value;var a=document.getElementById(d+"idNotif").value;var m=true;var o=false;$(d+"filtre_non_transmis").removeClass("inactif");document.getElementById(d+"blocAutresCriteres").className="";if(g=="Rechercher"){m=validerCriteres(d,document.getElementById(d+"dateDebut"),document.getElementById(d+"dateFin"))}if(g=="afficherPaiementsComplementaires"){reinitialiserCritereDeRecherche(d,false);o=true}if(g=="afficherPaiementsNonTransmisComplementaires"){reinitialiserCritereDeRecherche(d,true);g="afficherPaiementsComplementaires"}if(m==true){showLoadingPaiement();var f="/PortailAS/paiements.do?actionEvt="+g+"&idNoCache="+new Date().getTime()+"&DateDebut="+n+"&DateFin="+e+"&Beneficiaire="+j+"&afficherIJ="+h+"&afficherPT="+k+"&afficherInva="+i+"&afficherRentes="+b+"&afficherRS="+c+"&indexPaiement="+l+"&idNotif="+a;if(window.XMLHttpRequest){req=new XMLHttpRequest();req.onreadystatechange=function(){majPaiements(o)};req.open("GET",f,true);req.send(null)}else{if(window.ActiveXObject){req=new ActiveXObject("Microsoft.XMLHTTP");req.onreadystatechange=function(){majPaiements(o)};req.open("GET",f,true);req.send()}else{return}}}}function keyDownRecherchePaiement(d,a,c){if(c.defaultPrevented){return}var b=false;if(c.key!==undefined){switch(c.key){case"Enter":case" ":ajaxCallRemoteRecherchePaiement(d,a);b=true;default:break}}else{if(c.keyIdentifier!==undefined){switch(c.keyIdentifier){case"Enter":case"U+0020":ajaxCallRemoteRecherchePaiement(d,a);b=true;default:break}}else{if(c.keyCode!==undefined){switch(c.keyCode){case 13:case 32:ajaxCallRemoteRecherchePaiement(d,a);b=true;default:break}}}}if(b){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}}}function showLoadingPaiement(){var a=document.createElement("img");a.className="loading";a.id="loadingPaiementsImg";a.alt="Chargement...";a.src="/PortailAS/biblicnam/images/zoneMessage/roue-tempo.gif";document.getElementById("liste_paiement").appendChild(a);if(plusSixMoisAutorise){$("divBoutonHistorique").addClass("cnamts-hidden")}}function validerCriteres(f,b,e){var a=true;var c=/^(((0[1-9]|[12]\d|3[01])\/(0[13578]|1[02])\/((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\/(0[13456789]|1[012])\/((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\/02\/((19|[2-9]\d)\d{2}))|(29\/02\/((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))$/g;var d=/^(((0[1-9]|[12]\d|3[01])\/(0[13578]|1[02])\/((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\/(0[13456789]|1[012])\/((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\/02\/((19|[2-9]\d)\d{2}))|(29\/02\/((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))$/g;var n=document.getElementById(f+"dateDebut");var g=document.getElementById(f+"dateFin");var m=new Date();var l=5;if(plusSixMoisAutorise){l=26}var i=getDateMoinsNMois(l);var j=getDate(i);var k=b.value;var h=e.value;if(!ChampSaisieTag.isEmpty(b)&&!ChampSaisieTag.isEmpty(e)){ChampSaisieTag.champOK(b);ChampSaisieTag.champOK(e);ChampSaisieTag.controleDate(n);ChampSaisieTag.controleDate(g);if(document.getElementById(n.id+ChampSaisieTag.prefixIdZoneMessageErreur).innerHTML===""&&document.getElementById(g.id+ChampSaisieTag.prefixIdZoneMessageErreur).innerHTML===""){if(getDate(k)>getDate(h)){a=false;ChampSaisieTag.erreurChamp(g," La date de fin doit &ecirc;tre sup&eacute;rieure &agrave; la date de d&eacute;but.")}if(getDate(k)<j){a=false;ChampSaisieTag.erreurChamp(n,"La date de d&eacute;but ne peut &ecirc;tre ant&eacute;rieure &agrave; "+i)}if(getDate(h)>m){a=false;ChampSaisieTag.erreurChamp(g,"La date de fin doit &ecirc;tre ant&eacute;rieure ou &eacute;gale &agrave; la date du jour.")}if(c.test(k)==false){ChampSaisieTag.erreurChamp(n,"La date de d&eacute;but est invalide");a=false}if(d.test(h)==false){ChampSaisieTag.erreurChamp(g,"La date de fin est invalide");a=false}}}else{if(ChampSaisieTag.isEmpty(b)){a=false;ChampSaisieTag.erreurChamp(n,"La date de d&eacute;but est obligatoire")}if(ChampSaisieTag.isEmpty(e)){a=false;ChampSaisieTag.erreurChamp(g,"La date de fin est obligatoire")}}return a}function actualiserAffichagePaiementsNonTransmis(f){var e=!$(f.target).checked;var b=false;var d=document.querySelectorAll("[id^='lignePaiement']");if(e){for(var c=0;c<d.length;c++){$(d[c]).removeClass("invisible")}}else{for(var c=0;c<d.length;c++){var a=d[c];if($(a).classList.contains("paiementNonTransmis")){$(a).removeClass("invisible")}else{$(a).addClass("invisible")}}}affichageEnleverBandeau()}function getDate(c){var b=c.split("/");var a=new Date(b[2],b[1]-1,b[0]);return a}function getDateMoinsNMois(h){var d=new Date();var b=new Date(d.getFullYear(),d.getMonth()-h,0);b.setDate(Math.min(d.getDate(),b.getDate()));var c=d.getFullYear();var i=("0"+(d.getMonth()+1)).slice(-2);var g=("0"+d.getDate()).slice(-2);var f=("0"+(b.getMonth()+1)).slice(-2);var e=b.getFullYear();var a=("0"+b.getDate()).slice(-2);b=a+"/"+f+"/"+e;return b}function reinitialiserCritereDeRecherche(f,e){var b=new Date();var a=b.getFullYear();var d=("0"+(b.getMonth()+1)).slice(-2);var c=("0"+b.getDate()).slice(-2);document.getElementById(f+"dateDebut").value=getDateMoinsNMois(nombreReleves);document.getElementById(f+"dateFin").value=c+"/"+d+"/"+a;ChampSaisieTag.champOK(document.getElementById(f+"dateDebut"));ChampSaisieTag.champOK(document.getElementById(f+"dateFin"));document.getElementById(f+"benefSelectionne").value="tout_selectionner";document.getElementById(f+"afficherIJ").checked=false;document.getElementById(f+"afficherPT").checked=false;document.getElementById(f+"afficherInva").checked=false;document.getElementById(f+"afficherRentes").checked=false;document.getElementById(f+"afficherRS").checked=false;document.getElementById(f+"afficherNonTransmis").checked=e;miseAJourFiltre(f)}function majPaiements(b){if(req.readyState==4){if(req.status==200){afficherListePaiements(req);if(plusSixMoisAutorise){if(b){scroll.toElement("divBoutonHistorique")}afficherTextePlusSixMois()}var a={target:"paiements_1afficherNonTransmis"};actualiserAffichagePaiementsNonTransmis(a)}}}function afficherListePaiements(b){var a=document.getElementById("liste_paiement");var c=JSON.parse(b.responseText);a.innerHTML=c.tableauPaiement;if(plusSixMoisAutorise){$("divBoutonHistorique").removeClass("cnamts-hidden")}afficherNotificationPaiementNonTransmis(c.paiementNonTransmis)}function afficherTextePlusSixMois(){var c=$(portletContext+"dateDebut").value;var a=new Date();var b=getDateMoinsNMois(nombreReleves);if(getDate(c)<getDate(b)){$("textePlusSixMois").removeClass("cnamts-hidden");scroll.toElement("divBoutonHistorique")}else{$("textePlusSixMois").addClass("cnamts-hidden")}}function addPaiementsComplementaires(){if(req.readyState==4){if(req.status==200){ajouterListePaiements(req)}}}function ajouterListePaiements(b){var a=document.getElementById("liste_paiement");var c=JSON.parse(b.response);a.innerHTML=c.tableauPaiement;document.getElementById(portletContext+"liste_paiement").className="liste-paiement"}function ajoutEventListenerTelecharger(a,d,b,c){if(document.getElementById(a+b+c).addEventListener){document.getElementById(a+b+c).addEventListener("mouseover",function(){document.getElementById(d+b+c).style.display="inline-block"});document.getElementById(a+b+c).addEventListener("mouseout",function(){document.getElementById(d+b+c).style.display="none"})}else{if(document.getElementById(a+b+c).attachEvent){document.getElementById(a+b+c).attachEvent("onmouseover",function(){document.getElementById(d+b+c).style.display="inline-block"});document.getElementById(a+b+c).attachEvent("onmouseout",function(){document.getElementById(d+b+c).style.display="none"})}}}function resetTableauPaiement(){var a=document.getElementById("liste_paiement");if(document.getElementById("unordered_list")){var b=document.getElementById("unordered_list");a.removeChild(b)}}function ajaxCallRemoteChargerDetailPaiement(d,c,b,e){var a=document.getElementById("lignePaiement"+b+e);if(document.getElementById("detailPaiement"+b+e).innerHTML!==""){var g=document.getElementById("detailPaiement"+b+e);if(a.get("aria-expanded")==="false"){displayDetail(a,g);showDetails(b,e);cacherAutreDetails("detailPaiement"+b+e)}else{hideDetail(a,g,"false");closeDetails(a)}}else{loading("lignePaiement"+b+e,b,e);var f="/PortailAS/paiements.do?actionEvt=chargerDetailPaiements&idNoCache="+new Date().getTime()+"&idPaiement="+d+"&naturePaiement="+c+"&indexGroupe="+b+"&indexPaiement="+e;if(window.XMLHttpRequest){req2=new XMLHttpRequest();req2.onreadystatechange=majDetails;req2.open("GET",f,true);req2.send(null)}else{if(window.ActiveXObject){req2=new ActiveXObject("Microsoft.XMLHTTP");req2.onreadystatechange=majDetails;req2.open("GET",f,true);req2.send()}else{return}}}}function keyDownChargerDetailPaiement(c,b,a,d,g){if(g.defaultPrevented){return}var f=false;if(g.key!==undefined){switch(g.key){case"Enter":case" ":ajaxCallRemoteChargerDetailPaiement(c,b,a,d);f=true;default:break}}else{if(g.keyIdentifier!==undefined){switch(g.keyIdentifier){case"Enter":case"U+0020":ajaxCallRemoteChargerDetailPaiement(c,b,a,d);f=true;default:break}}else{if(g.keyCode!==undefined){switch(g.keyCode){case 13:case 32:ajaxCallRemoteChargerDetailPaiement(c,b,a,d);f=true;default:break}}}}if(f){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}}}function loading(a,b,c){var f=document.getElementById(a);f.className+=" open";var d=document.getElementById("detailPaiement"+b+c);var e=document.createElement("img");e.className="loading";e.id="loading"+b+c;e.alt="Chargement...";e.src="/PortailAS/biblicnam/images/zoneMessage/roue-tempo.gif";d.appendChild(e);d.style.overflow="hidden";d.style.height="auto";d.style.display="none";displayDetail(f,d)}function majDetails(){if(req2.readyState==4){if(req2.status==200){afficherDetailPaiement(req2)}}}function afficherDetailPaiement(g){var e=g.responseXML;var f=g.responseText;var i=e.getElementsByTagName("detailPaiement");var a=i.length;for(var h=0;h<a;h++){var j=i[h].getAttribute("indexGroupe");var d=i[h].getAttribute("indexPaiment");var c=document.getElementById("lignePaiement"+j+d);var b=document.getElementById("detailPaiement"+j+d);b.innerHTML=f;constructionFooter(j,d);displayDetail(c,b);cacherAutreDetails("detailPaiement"+j+d);if(document.getElementById("loading"+j+d)){document.getElementById("loading"+j+d).style.display="none"}}}function constructionFooter(b,f){var g=document.getElementById("detailPaiement"+b+f);var a=document.createElement("div");a.id="footer"+b+f;a.className="detailfooter container";g.appendChild(a);var c=document.createElement("div");c.className="fermer";g.appendChild(c);var d=document.createElement("a");d.className="";d.tabIndex=0;c.appendChild(d);var e=document.createElement("span");e.innerHTML=document.getElementById("libFermer").innerHTML+" ";d.appendChild(e)}function showDetails(a,b){var c=document.getElementById("lignePaiement"+a+b).className;listeClassName=c.split(" ");if(document.getElementById("detailPaiement"+a+b).innerHTML!==""){if(c.search("open")==-1){document.getElementById("lignePaiement"+a+b).className=c+" open"}}}function closeDetails(b){var d=b.className;var e=d.split(" ");var a="";for(var c=0;c<e.length;c++){if(e[c]!="open"){a+=e[c]+" "}}b.className=a}function displayDetail(a,c){a.setAttribute("aria-expanded","true");var b=new Fx.Tween(c,{duration:500,transition:Fx.Transitions.Quad.easeInOut,property:"height",onComplete:function(){c.setAttribute("aria-hidden","false");c.style.height="auto";c.style.overflow="visible"}});b.start("0",c.getDimensions().y);(function(){this.setStyle("display","block")}).delay(50,c)}function hideDetail(a,d,c){a.setAttribute("aria-expanded",c);a.focus();d.style.overflow="hidden";var b=new Fx.Tween(d,{duration:500,transition:Fx.Transitions.Quad.easeInOut,property:"height",onComplete:function(){d.setAttribute("aria-hidden","true");d.style.height="auto";d.style.display="none"}});b.start(d.getDimensions().y,"0")}function cocherDecocherRS(a){if(document.getElementById(a+"afficherRS").checked){document.getElementById(a+"afficherRS").checked=false}else{document.getElementById(a+"afficherRS").checked=true}}function stopPropagation(a){if(!a){a=window.event}if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}}function getElementsByClassName(d,b){var c=[];if(!b){b=document}else{if(typeof b=="string"){b=document.getElementById(b)}}var e=b.getElementsByTagName("*");for(var a=0;a<e.length;a++){if(e[a].className==d){c.push(e[a])}}return c}function cacherAutreDetails(e){var d=getElementsByClassName("detail","");var f=d.length;for(var c=0;c<f;c++){var a=d[c].id;if(a!=e){var b=document.getElementById(d[c].getAttribute("aria-labelledby"));if(b.get("aria-expanded")==="true"){hideDetail(b,d[c],"false");closeDetails(b)}}}}function afficheBulle(c,b){if(document.getElementById(c+"idAideRemboursement").hasClass("invisible")){Fenetre.components[c+"idAideRemboursement"].open();var a=$("AideRemboursement"+b).getPosition().x+$("AideRemboursement"+b).getComputedSize().totalWidth;if(document.getElementById(c+"idAideRemboursement").getComputedSize().totalWidth+a<$(document.body).getSize().x){$(c+"idAideRemboursement").position({relativeTo:"AideRemboursement"+b,position:"upperRight",edge:"upperLeft"})}else{$(c+"idAideRemboursement").position({relativeTo:"AideRemboursement"+b,position:"bottomRight",edge:"upperRight"})}}else{Fenetre.components[c+"idAideRemboursement"].close()}}function miseAJourFiltre(a){if(document.getElementById(a+"afficherNonTransmis").checked==true){document.getElementById(a+"blocCritereTypePaiement").hidden=true;document.getElementById(a+"blocCritereBeneficiaire").hidden=true;remplacerDisplayElement(".spanTelechargerPaiementNT","inline-block");remplacerDisplayElement(".col-download","none");remplacerDisplayElement(".col-transmission","inline-block");if(document.querySelectorAll(".checkboxPaiementNonTransmis").length>0){remplacerDisplayElement("#bouttonTelechargerPaiementNonTransmis","inline-block")}}else{document.getElementById(a+"blocCritereTypePaiement").hidden=false;document.getElementById(a+"blocCritereBeneficiaire").hidden=false;remplacerDisplayElement(".spanTelechargerPaiementNT","none");remplacerDisplayElement(".col-download","inline-block");remplacerDisplayElement(".col-transmission","none");remplacerDisplayElement("#bouttonTelechargerPaiementNonTransmis","none")}miseAJourBouttonAfficherPlus(document.getElementById(a+"afficherNonTransmis").checked)}function miseAJourBouttonAfficherPlus(a){if(document.getElementById("btAfficherPlus")!=null){if(a){document.getElementById("btAfficherPlus").childNodes[0].setAttribute("onclick","ajaxCallRemoteRecherchePaiement('paiements_1','afficherPaiementsNonTransmisComplementaires')")}else{document.getElementById("btAfficherPlus").childNodes[0].setAttribute("onclick","ajaxCallRemoteRecherchePaiement('paiements_1','afficherPaiementsComplementaires')")}}}function remplacerDisplayElement(d,e){var b=document.querySelectorAll(d),c=0,a=b.length;for(c;c<a;c++){b[c].style.display=e}}function redirectionPaiementNonTransmis(a){if(document.getElementById(a+"afficherNonTransmis").checked==false){document.getElementById(a+"afficherNonTransmis").checked=true;ajaxCallRemoteRecherchePaiement(a,"afficherPaiementsNonTransmisComplementaires");actualiserAffichagePaiementsNonTransmis(event);miseAJourFiltre(a)}}function afficherNotificationPaiementNonTransmis(a){portletContext="paiements_1";if(a==true){document.getElementById(portletContext+"notifPaiementNonTransmis").classList.remove("bandeauInvisible");document.getElementById(portletContext+"labelRadioPaiementNonTransmis").classList.add("paiementNonTransmis")}else{document.getElementById(portletContext+"notifPaiementNonTransmis").classList.add("bandeauInvisible");document.getElementById(portletContext+"labelRadioPaiementNonTransmis").classList.remove("paiementNonTransmis")}miseAJourFiltre(portletContext);miseAJourBouttonAfficherPlus(document.getElementById(portletContext+"afficherNonTransmis").checked)}function peutTelechargerPDFNonTransmis(b){var a=document.getElementById("liste_paiement").querySelectorAll("input[type=checkbox]:checked").length;if(a>0){if(a>b){affichageErreurBandeau("ErreurCheckboxPaiment");document.getElementById("bouttonTelechargerPaiementNonTransmis").disabled=true}else{affichageEnleverBandeau();document.getElementById("bouttonTelechargerPaiementNonTransmis").disabled=false}}else{document.getElementById("bouttonTelechargerPaiementNonTransmis").disabled=true}}function telechargerPDFNonTransmis(g){afficher_fenetre("TelechargerPDFPaiementNonTransmis");document.getElementById("bouttonTelechargerPaiementNonTransmis").disabled=true;if(!document.getElementById(g+"BandeauErreur").classList.contains("bandeauInvisible")){document.getElementById(g+"BandeauErreur").classList.add("bandeauInvisible")}var d=document.getElementById(g+"BandeauErreur").querySelectorAll(".messageBandeauErreur");for(var c=0;c<d.length;c++){if(d[c].classList.contains("messageInvisible")){d[c].classList.add("messageInvisible")}}var a=[];var b=document.getElementById("liste_paiement").querySelectorAll("input[type=checkbox]:checked");var f="";for(var c=0;c<b.length;c++){f+="&idPaiement="+b[c].value}var e="/PortailAS/paiements.do?actionEvt=telechargerPDFPaiementNonTransmis"+f;if(window.XMLHttpRequest){req3=new XMLHttpRequest();req3.onreadystatechange=majPdfPaiementNonTransmis;req3.open("GET",e,true);req3.send(null)}else{if(window.ActiveXObject){req3=new ActiveXObject("Microsoft.XMLHTTP");req3.onreadystatechange=majPdfPaiementNonTransmis;req3.open("GET",e,true);req3.send()}else{return}}}function majPdfPaiementNonTransmis(){if(req3.readyState==4){if(req3.status==200){afficherPDF(req3)}}}function afficherPDF(c){fermer_fenetre("TelechargerPDFPaiementNonTransmis");var d=JSON.parse(c.responseText);if(d.erreur!=""){affichageErreurBandeau(d.erreur)}else{document.getElementById("idPDFPaiementNonTransmis").value=d.identifiantPDF;openFormPopup(document.getElementById("pdfPopup"),"popup")}document.getElementById("bouttonTelechargerPaiementNonTransmis").disabled=true;var a=document.getElementById("liste_paiement").querySelectorAll("input[type=checkbox]:checked");for(var b=0;b<a.length;b++){a[b].checked=false}}function affichageErreurBandeau(a){portletContext="paiements_1";document.getElementById(portletContext+"BandeauErreur").classList.remove("bandeauInvisible");document.getElementById(portletContext+a).classList.remove("messageInvisible");document.body.scrollTop=document.documentElement.scrollTop=0}function affichageEnleverBandeau(){portletContext="paiements_1";document.getElementById(portletContext+"BandeauErreur").classList.add("bandeauInvisible");document.getElementById(portletContext+"ErreurCheckboxPaiment").classList.add("messageInvisible");document.getElementById(portletContext+"ErreurPDF").classList.add("messageInvisible")}function ajaxCallAfficherPlusReleves(){$("loader").removeClass("cnamts-hidden");$("btAfficherPlus").addClass("cnamts-hidden");$("zone-erreur").addClass("cnamts-hidden");$("afficherPlusReleves").disabled=true;var b,a,d;$$('div[id^="blocParMois"]').each(function(e,f){if(e.isVisible()){b=f+1}});a=b+1;d=a+nbMoisAAfficher;var c="/PortailAS/portlets/relevemensuelpaiement/relevemensuelpaiement.do?actionEvt=afficherPlusReleves&idNoCache="+new Date().getTime();if(window.XMLHttpRequest){reqAfficherSuiteReleves=new XMLHttpRequest();reqAfficherSuiteReleves.onreadystatechange=function(){afficherRelevesMensuels(a,d)};reqAfficherSuiteReleves.open("GET",c,true);reqAfficherSuiteReleves.send(null)}else{if(window.ActiveXObject){reqAfficherSuiteReleves=new ActiveXObject("Microsoft.XMLHTTP");reqAfficherSuiteReleves.onreadystatechange=function(){afficherRelevesMensuels(a,d)};reqAfficherSuiteReleves.open("GET",c,true);reqAfficherSuiteReleves.send()}else{return}}}function afficherRelevesMensuels(a,h){var b;if(reqAfficherSuiteReleves.readyState===4){if(reqAfficherSuiteReleves.status===200){$("loader").addClass("cnamts-hidden");$("btAfficherPlus").removeClass("cnamts-hidden");$("afficherPlusReleves").disabled=false;var d=0;var g=JSON.parse(reqAfficherSuiteReleves.responseText);if(g.erreurRecupPaiements){$("zone-erreur").removeClass("cnamts-hidden")}else{var f=g.listeDecomptes;for(var c=a;c<a+nbMoisAAfficher;c++){if($("blocParMois"+c)){var e=f[d];$("moisEnCours"+c).innerHTML=e.mois;if(e.montant!==""){$("lienRelMensuel"+c).removeClass("cnamts-hidden");$("lienPDFReleve"+c).href=e.urlPDF}else{$("libelleSansPaiement"+c).removeClass("cnamts-hidden")}$("blocParMois"+c).removeClass("cnamts-hidden");h=c}if(nbMoisMax===c){b=true}d++}if(b){$("btAfficherPlus").addClass("cnamts-hidden");scroll.toElement("blocParMois"+h)}else{scroll.toElement("btAfficherPlus")}}}}};